## Overview
This repository contains code that create a dataset of global stock returns and characteristics. The dataset was created for the paper [Is There a Replication Crisis in Finance?](https://papers.ssrn.com/sol3/papers.cfm?abstract_id=3774514) by Jensen, Kelly and Pedersen (2021). Please cite this paper if you are using the code or data.

Documentation.pdf provides detailed descriptions of the code and all data construction choices. chars.xlsx lists the 153 factors (and their original sources, directional bets, and significance in the original paper) studied in Jensen, Kelly and Pedersen (2021), which is a subset of the factors/characteristics generated by this code.

## How to Run the Code
The .sas files construct the stock-level characteristics and factor portfolio returns for all countries. The code requires a connection to WRDS servers. Below we outline our preferred approach to creating the dataset:

1. Connect to the [SAS studio server hosted by WRDS](https://wrds-cloud.wharton.upenn.edu/SASStudio/index?locale=en_US).  
2. Create a folder called _Global Data_ in your home directory and upload `main.sas`, `project_macros.sas`, `market_chars.sas`, `accounting_chars.sas`, `char_macros.sas`, `portfolios.sas`, `ind_identification.sas` and `chars.xlsx` to this folder.
3. Create an empty folder in your institutions scratch folder. The scratch folder is located at "Sever Files and Folders/Files/scratch/\<institution name\>".
4. Open `main.sas` 
5. Replace line 7 with the path to the scratch folder created in step 3. 
6. Run `main.sas`. 

Running the code will take around 48 hours. The code will save several datasets in your scratch folder. The main dataset is called _world_data.sas7bdat_. It includes stock identifiers, returns and characteristics for all securities available in CRSP and Compustat. If you want the dataset in a .csv format, run the _%save_main_data_csv()_ macro located at the bottom of `main.sas`. Running the macro will create a zip folder with a separate .csv file for each country. Importantly, this datasets only include the main observation of common stocks that are primary securities, with non-missing market equity and return data. Finally, _market_returns.csv_ contain market returns of all countries in our sample. 

The remaining files saved in the scratch directory are intermidiate tables. We save the intermidiate tables to avoid re-running all steps in case of connection issues and other errors that causes the code to terminate. In case of storage issues, it might be neccesary to avoid saving these intermidiate files and instead refer directly to the file in the work directory. 
Note that the space in the scratch directory is shared across users in your institution. It's best practice to delete files after downloading what you need. Furthermore, files in the scratch directory is deleted after 7 days.
